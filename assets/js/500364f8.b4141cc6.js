"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[3063],{9747(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"Toolchain/Tutorials/Tutorial-\u2010-Step-3","title":"Step 3: Adding Interactions","description":"\ud83c\udfaf Objectives","source":"@site/docs/Toolchain/10-Tutorials/05-Tutorial-\u2010-Step-3.md","sourceDirName":"Toolchain/10-Tutorials","slug":"/Toolchain/Tutorials/Tutorial-\u2010-Step-3","permalink":"/Toolchain/Tutorials/Tutorial-\u2010-Step-3","draft":false,"unlisted":false,"editUrl":"https://github.com/project-SIMPLE/documentation/tree/main/docs/Toolchain/10-Tutorials/05-Tutorial-\u2010-Step-3.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"docSidebar","previous":{"title":"Step 2: Creation of the Unity basic game","permalink":"/Toolchain/Tutorials/Tutorial-\u2010-Step-2"},"next":{"title":"Installation Guide: Unity & Development Environment","permalink":"/Toolchain/Unity-Installation-Guide"}}');var s=t(4848),r=t(8453);const o={},a="Step 3: Adding Interactions",c={},l=[{value:"\ud83c\udfaf Objectives",id:"-objectives",level:2},{value:"1. GAMA Model Modifications",id:"1-gama-model-modifications",level:2},{value:"A. Update <code>Traffic and Pollution.gaml</code>",id:"a-update-traffic-and-pollutiongaml",level:3},{value:"B. Update Traffic Logic",id:"b-update-traffic-logic",level:3},{value:"C. Enable Live Updates",id:"c-enable-live-updates",level:3},{value:"D. Update Traffic and Pollution-VR.gaml",id:"d-update-traffic-and-pollution-vrgaml",level:3},{value:"2. Unity Project Modifications",id:"2-unity-project-modifications",level:2},{value:"A. Extend Interaction Distance",id:"a-extend-interaction-distance",level:3},{value:"B. Programming the Interaction",id:"b-programming-the-interaction",level:3},{value:"3. Advanced: Custom Controller Buttons",id:"3-advanced-custom-controller-buttons",level:3}];function d(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"step-3-adding-interactions",children:"Step 3: Adding Interactions"})}),"\n",(0,s.jsx)(n.h2,{id:"-objectives",children:"\ud83c\udfaf Objectives"}),"\n",(0,s.jsx)(n.p,{children:"The aim of this step is to enable simple interactions from the VR headset."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Main Interaction:"})," Block specific roads by selecting them with the interaction ray."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Visual Feedback:"})," Change road colors based on selection and hover states."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Advanced Usage:"})," Understand how to map specific controller buttons to custom scripts (e.g., changing brightness)."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"1-gama-model-modifications",children:"1. GAMA Model Modifications"}),"\n",(0,s.jsx)(n.p,{children:'First, we must update the GAMA model to support the "blocked" state and handle commands sent from Unity.'}),"\n",(0,s.jsxs)(n.h3,{id:"a-update-traffic-and-pollutiongaml",children:["A. Update ",(0,s.jsx)(n.code,{children:"Traffic and Pollution.gaml"})]}),"\n",(0,s.jsxs)(n.p,{children:["We need to add a ",(0,s.jsx)(n.code,{children:"blocked"})," attribute to the roads and update their visual aspect."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Open ",(0,s.jsx)(n.strong,{children:"Traffic and Pollution.gaml"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Update the ",(0,s.jsx)(n.strong,{children:"road species"})," as follows:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-gaml",children:"species road {\n    // ... existing attributes ...\n    bool blocked <- false;\n\n    aspect default {\n        // Roads turn red if blocked, white otherwise\n        draw (shape + 5) color: blocked ? #red : #white;\n    }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://github.com/user-attachments/assets/2b5a2e04-80cc-4e81-83d0-195a65573437",alt:"TutorialGAMARoad"})}),"\n",(0,s.jsx)(n.h3,{id:"b-update-traffic-logic",children:"B. Update Traffic Logic"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File"}),": ",(0,s.jsx)(n.code,{children:"Traffic and Pollution.gaml"}),"(Global Section)"]}),"\n",(0,s.jsxs)(n.p,{children:["To ensure cars intelligently avoid blocked roads, we need to modify the ",(0,s.jsx)(n.strong,{children:"weight"})," (cost) associated with each road in the simulation's network. By applying a massive multiplier to blocked roads, the pathfinding algorithm will naturally redirect traffic to alternative routes."]}),"\n",(0,s.jsx)(n.p,{children:"Add or update the following reflex in your global section:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-gaml",children:"// Reflex to update the speed of the roads according to the weights\nreflex update_road_speed {\n    // If blocked, weight is multiplied by 100,000, effectively making it impassable\n    road_weights <- road as_map (each::(each.shape.perimeter / each.speed_coeff * (each.blocked ? 100000.0 : 1.0)));\n    road_network <- road_network with_weights road_weights;\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u2139\ufe0f This logic uses a conditional operator (",(0,s.jsx)(n.code,{children:"condition ? true_value : false_value"}),"). If blocked is true, it applies the ",(0,s.jsx)(n.code,{children:"100,000"})," multiplier; otherwise, it keeps the original weight."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://github.com/user-attachments/assets/bd7460c4-3f1d-480e-8773-c9ebd3e5eec8",alt:"TutorialGAMAGlobal"})}),"\n",(0,s.jsx)(n.h3,{id:"c-enable-live-updates",children:"C. Enable Live Updates"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File"}),": Traffic and Pollution.gaml (Experiment Section)"]}),"\n",(0,s.jsx)(n.p,{children:"To visualize the color change in GAMA's display, we must enable the refresh rate for the road species."}),"\n",(0,s.jsxs)(n.p,{children:["Find the line ",(0,s.jsx)(n.code,{children:"species road refresh: false;"})," and change it to ",(0,s.jsx)(n.code,{children:"species road refresh: true;"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://github.com/user-attachments/assets/e3b2beac-213e-496b-aa69-818267e4c954",alt:"TutorialGAMADisplay"})}),"\n",(0,s.jsx)(n.h3,{id:"d-update-traffic-and-pollution-vrgaml",children:"D. Update Traffic and Pollution-VR.gaml"}),"\n",(0,s.jsx)(n.p,{children:"We need to add an action that Unity will trigger to toggle the blocked state."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-gaml",children:"    // Map to link road names to their agents\n    map<string,road> roads <- road as_map (each.name :: each);\n\n    action block_road(string id) {\n        road b <- roads[id];\n        if (b != nil) {\n            ask b {\n                // Toggle blocked state\n                blocked <- !blocked;\n            }\n        }\n    }\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://github.com/user-attachments/assets/67e61064-cbaa-4ed2-8864-77e7b511e67e",alt:"TutorialGAMAUnityLinker"})}),"\n",(0,s.jsx)(n.h2,{id:"2-unity-project-modifications",children:"2. Unity Project Modifications"}),"\n",(0,s.jsx)(n.p,{children:"Now, let's configure Unity to interact with these new GAMA features."}),"\n",(0,s.jsx)(n.h3,{id:"a-extend-interaction-distance",children:"A. Extend Interaction Distance"}),"\n",(0,s.jsx)(n.p,{children:'Since we are in "Sky View," the default interaction ray might be too short to reach the roads.'}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["In the ",(0,s.jsx)(n.strong,{children:"Hierarchy"}),", select: ",(0,s.jsx)(n.code,{children:"SkyViewPlayer"})," > ",(0,s.jsx)(n.code,{children:"Camera Offset"})," > ",(0,s.jsx)(n.code,{children:"Right Controller"})," > ",(0,s.jsx)(n.code,{children:"Near-Far Interactor"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["In the ",(0,s.jsx)(n.strong,{children:"Inspector"}),", find the ",(0,s.jsx)(n.strong,{children:"Curve Interaction Caster"})," component."]}),"\n",(0,s.jsxs)(n.li,{children:["Under ",(0,s.jsx)(n.strong,{children:"Curve Casting Settings"}),", set ",(0,s.jsx)(n.strong,{children:"Cast Distance"})," to ",(0,s.jsx)(n.code,{children:"1000"}),"."]}),"\n"]}),"\n",(0,s.jsx)("img",{width:"1138",alt:"CastDist",src:"https://github.com/user-attachments/assets/4d05f6e7-9d5c-4eb8-8b6f-d0fe22b2e439"}),"\n",(0,s.jsx)(n.h3,{id:"b-programming-the-interaction",children:"B. Programming the Interaction"}),"\n",(0,s.jsx)(n.p,{children:"We need to modify the C# script that handles what happens when the ray hits an object."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"How to open the code:"}),"\nYou have two ways to access the script:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"1. Via Inspector:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Select the Manager (or Game Manager) object in the Hierarchy."}),"\n",(0,s.jsxs)(n.li,{children:["In the Inspector, locate the ",(0,s.jsx)(n.strong,{children:"Simulation Manager Interaction"})," component."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Double-click"})," on the Script field (where it says ",(0,s.jsx)(n.code,{children:"SimulationManagerInteraction.cs"}),")."]}),"\n"]}),"\n",(0,s.jsx)("img",{width:"1550",alt:"Capture d\u2019e\u0301cran 2026-02-13 a\u0300 13 40 36",src:"https://github.com/user-attachments/assets/1be072d7-78e8-4275-a33e-8c7c0683fdee"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"2. Via Project Window( Alternative):"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["In the ",(0,s.jsx)(n.strong,{children:"Unity Project Window"})," (bottom panel), navigate to the folder: ",(0,s.jsx)(n.code,{children:"Assets"})," > ",(0,s.jsx)(n.code,{children:"Scripts"})," > ",(0,s.jsx)(n.code,{children:"Gama Provider"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Double-click"})," the script: ",(0,s.jsx)(n.code,{children:"SimulationManagerInteraction.cs"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Unity opens Visual Studio, allowing you to edit the script."}),"\n",(0,s.jsx)("img",{width:"1840",alt:"Capture d\u2019e\u0301cran 2026-02-13 a\u0300 13 40 52",src:"https://github.com/user-attachments/assets/ae76f090-7bcc-4aba-9692-08bd65addb3d"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Modify the following three methods inside the script:"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"1. Hover Enter (Pointer enters the road)"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Description:"}),"\nThis method triggers when the VR pointer ",(0,s.jsx)(n.strong,{children:"starts touching"})," an object. It provides immediate visual feedback to the user."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["It checks if the object is tagged as a ",(0,s.jsx)(n.code,{children:'"road"'}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["It changes the color to ",(0,s.jsx)(n.strong,{children:"Blue"})," to indicate interaction is possible."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-C#",children:'protected override void HoverEnterInteraction(HoverEnterEventArgs ev)\n{\n    GameObject obj = ev.interactableObject.transform.gameObject;\n    if (obj.tag.Equals("road"))\n        ChangeColor(obj, Color.blue); // Visual feedback\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"2. Hover Exit (Pointer leaves the road)"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Description:"}),"\nThis method triggers when the VR pointer ",(0,s.jsx)(n.strong,{children:"leaves"})," the object. It resets the color based on the object's logic state."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["It checks if the road is currently in the ",(0,s.jsx)(n.code,{children:"SelectedObjects"})," list (meaning it is blocked)."]}),"\n",(0,s.jsxs)(n.li,{children:["If ",(0,s.jsx)(n.strong,{children:"Selected (Blocked)"}),": It turns ",(0,s.jsx)(n.strong,{children:"Red"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["If ",(0,s.jsx)(n.strong,{children:"Not Selected (Free)"}),": It reverts to default ",(0,s.jsx)(n.strong,{children:"Gray"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-C#",children:'protected override void HoverExitInteraction(HoverExitEventArgs ev)\n{\n    GameObject obj = ev.interactableObject.transform.gameObject;\n    if (obj.tag.Equals("road"))\n    {\n        bool isSelected = SelectedObjects.Contains(obj);\n        ChangeColor(obj, isSelected ? Color.red : Color.gray);\n    }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"3. Select Interaction (Clicking the Trigger)"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Description:"}),"\nThis method triggers when the user presses the ",(0,s.jsx)(n.strong,{children:"Trigger button"})," while pointing at an object. It handles the main logic."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cooldown:"})," Checks ",(0,s.jsx)(n.code,{children:"remainingTime"})," to prevent accidental double-clicks."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"GAMA Communication:"})," Asks GAMA to trigger the ",(0,s.jsx)(n.code,{children:"block_road"})," action with the road's ID."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Local State:"})," Toggles the road's status in the ",(0,s.jsx)(n.code,{children:"SelectedObjects"})," list and updates the color immediately."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-C#",children:'protected override void SelectInteraction(SelectEnterEventArgs ev)\n{\n    if (remainingTime <= 0.0)\n    {\n        GameObject obj = ev.interactableObject.transform.gameObject;\n        if (obj.tag.Equals("road"))\n        {\n            Dictionary<string, string> args = new Dictionary<string, string> {\n                {"id", obj.name }\n            };\n            // Trigger the GAMA action\n            ConnectionManager.Instance.SendExecutableAsk("block_road", args);\n\n            // Toggle selection state and color in Unity\n            bool newSelection = !SelectedObjects.Contains(obj);\n            if (newSelection) SelectedObjects.Add(obj);\n            else SelectedObjects.Remove(obj);\n\n            ChangeColor(obj, newSelection ? Color.red : Color.gray);\n            remainingTime = timeWithoutInteraction; // 1s cooldown\n        }\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"3-advanced-custom-controller-buttons",children:"3. Advanced: Custom Controller Buttons"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"(Informational only - not required for the main tutorial)"})}),"\n",(0,s.jsx)(n.p,{children:'To map a specific physical button (like the "A" or "X" button) to an action:'}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Define the Action"}),": Double-click ",(0,s.jsx)(n.code,{children:"Assets/Samples/XR Interaction Toolkit/[Version]/Starter Assets/XRI"})," Default Input Actions."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Add Binding"}),": In ",(0,s.jsx)(n.code,{children:"XRI RightHand Interaction"}),', add a new action (e.g., "Main Button") and bind it to the controller\'s primary button.']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Reference in Script"}),": Use ",(0,s.jsx)(n.code,{children:"[SerializeField] private InputActionReference primaryRightHandButton;"})," in your script."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Link in Inspector"}),": Drag the Input Action into the corresponding field on your ",(0,s.jsx)(n.strong,{children:"Game Manager"})," object."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Detect Press"}),":"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-C#",children:"if (primaryRightHandButton != null && primaryRightHandButton.action.triggered) {\n    TriggerMainButton(); // Your custom function here\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,n,t){t.d(n,{R:()=>o,x:()=>a});var i=t(6540);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);